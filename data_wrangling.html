<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Bin Yang" />

<meta name="date" content="2020-11-11" />

<title>data_wrangling</title>

<script src="site_libs/header-attrs-2.3/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="bootstrap.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Need a Vacation? Book a Hotel!</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="home.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="eda.html">EDA</a>
</li>
<li>
  <a href="model.html">Model Building</a>
</li>
<li>
  <a href="mailto:&lt;xl3048@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/xylatgit/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">data_wrangling</h1>
<h4 class="author">Bin Yang</h4>
<h4 class="date">11/11/2020</h4>

</div>


<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.2     ✓ purrr   0.3.4
## ✓ tibble  3.0.4     ✓ dplyr   1.0.2
## ✓ tidyr   1.1.2     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(tidymodels)</code></pre>
<pre><code>## ── Attaching packages ────────────────────────────────────── tidymodels 0.1.2 ──</code></pre>
<pre><code>## ✓ broom     0.7.2      ✓ recipes   0.1.15
## ✓ dials     0.0.9      ✓ rsample   0.0.8 
## ✓ infer     0.5.3      ✓ tune      0.1.2 
## ✓ modeldata 0.1.0      ✓ workflows 0.2.1 
## ✓ parsnip   0.1.4      ✓ yardstick 0.0.7</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
## x scales::discard() masks purrr::discard()
## x dplyr::filter()   masks stats::filter()
## x recipes::fixed()  masks stringr::fixed()
## x dplyr::lag()      masks stats::lag()
## x yardstick::spec() masks readr::spec()
## x recipes::step()   masks stats::step()</code></pre>
<pre class="r"><code>library(plotly)</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<pre class="r"><code>library(viridis)</code></pre>
<pre><code>## Loading required package: viridisLite</code></pre>
<pre><code>## 
## Attaching package: &#39;viridis&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:scales&#39;:
## 
##     viridis_pal</code></pre>
<pre class="r"><code>library(modelr)</code></pre>
<pre><code>## 
## Attaching package: &#39;modelr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:yardstick&#39;:
## 
##     mae, mape, rmse</code></pre>
<pre><code>## The following object is masked from &#39;package:broom&#39;:
## 
##     bootstrap</code></pre>
<pre class="r"><code>knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = &quot;90%&quot;
)

theme_set(theme_minimal() + theme(legend.position = &quot;bottom&quot;))

options(
  ggplot2.continuous.colour = &quot;viridis&quot;,
  ggplot2.continuous.fill = &quot;viridis&quot;
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d</code></pre>
<div id="eda" class="section level4">
<h4>EDA</h4>
<p>Summary of the dataset:</p>
<pre class="r"><code>hotel_df = 
  read.csv(&quot;./data/hotel_bookings.csv&quot;,na = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)) %&gt;% 
  mutate_if(is.character, as.factor)</code></pre>
<p>produce summary tables for categorical variables:</p>
<pre class="r"><code># skimr::skim(hotel_df)
# hotel_df %&gt;% 
#   select(which(sapply(.,is.character))) %&gt;% 
#   gtsummary::tbl_summary(by = hotel)</code></pre>
<p>Possible plotly plots! (will edit labels etc. later)</p>
<p>Booking and cancellation by month: I think color is pretty awful rn……</p>
<p>Bar plot:</p>
<pre class="r"><code># hotel_df %&gt;% 
#   select(arrival_date_month, is_canceled) %&gt;% 
#   mutate(arrival_date_month = as.factor(arrival_date_month),
#          is_canceled = as.factor(is_canceled)) %&gt;% 
#   count(arrival_date_month, is_canceled) %&gt;% 
#   mutate(arrival_date_month = fct_reorder(arrival_date_month, n)) %&gt;% 
#   plot_ly(x = ~arrival_date_month, y = ~ n, color = ~is_canceled, type =&quot;bar&quot;, colors = &quot;viridis&quot;)
#   </code></pre>
<p>Does the hotel charged differently for different customer type?</p>
<p>need to do: modify axies, deal with outliers!</p>
<p>boxplot:</p>
<pre class="r"><code># hotel_df %&gt;% 
#   select(hotel, customer_type, adr) %&gt;% 
#   mutate(hotel= as.factor(hotel), 
#          customer_type = as.factor(customer_type),
#          customer_type = fct_reorder(customer_type, adr))%&gt;%
#   plot_ly(y = ~adr, x = ~customer_type, color = ~hotel, type =&quot;box&quot; , colors = &quot;viridis&quot;) %&gt;% 
#   layout(boxmode = &quot;group&quot;, yaxis = list(range=c(0,800)))</code></pre>
<p>Home country of guests!</p>
<p>a lot to improve… hover etc… choropleth maps:</p>
<pre class="r"><code># hotel_df %&gt;% 
#   select(country, is_canceled) %&gt;% 
#   filter(is_canceled == 0) %&gt;% 
#   group_by(country) %&gt;% 
#   summarise(
#     total_booking = n(),
#   ) %&gt;% 
#   mutate(
#     booking_percent = round(total_booking/sum(total_booking)*100, 2)
#   ) %&gt;% 
#   plot_ly(locations = ~country, z = ~booking_percent, type =&quot;choropleth&quot;,
#           colorscale=&quot;Viridis&quot;, zmin = 0, zmax = 30)</code></pre>
</div>
<div id="logistic-regression" class="section level4">
<h4>Logistic Regression :</h4>
<p>data preprocessing:</p>
<p>total NAs:</p>
<pre class="r"><code># table_NA=
#   hotel_df %&gt;% 
#   summarise_all(funs(sum(is.na(.))))
# 
# t(table_NA) %&gt;% 
#   knitr::kable()</code></pre>
<pre class="r"><code># hotel_ml = 
#   hotel_df %&gt;% 
#   mutate(
#     arrival_season = case_when(
#       arrival_date_month %in% c(&quot;October&quot;,&quot;November&quot;,&quot;December&quot;) ~ &quot;Fall&quot;,
#       arrival_date_month %in% c(&quot;January&quot;,&quot;February&quot;,&quot;March&quot;) ~ &quot;Winter&quot;,
#       arrival_date_month %in% c(&quot;April&quot;,&quot;May&quot;,&quot;June&quot;) ~ &quot;Spring&quot;,
#       TRUE ~ &quot;Summer&quot;
#     ),
#     arrival_season = as.factor(arrival_season),
#     reserved_room_type = as.character(reserved_room_type),
#     assigned_room_type = as.character(assigned_room_type),
#     false_room_assignment = case_when(
#       reserved_room_type == assigned_room_type ~ &quot;0&quot;,
#       reserved_room_type != assigned_room_type ~ &quot;1&quot;
#     ),
#     false_room_assignment = as.factor(false_room_assignment),
#     is_canceled = as.factor(is_canceled)) %&gt;% 
#     select(-c(arrival_date_year, arrival_date_week_number, arrival_date_day_of_month,
#               arrival_date_month, reservation_status_date, reservation_status, 
#               agent, company, country, reserved_room_type, assigned_room_type)) </code></pre>
<p>read in dataset:</p>
<pre class="r"><code>hotel_ml = 
  read_csv(&quot;./data/hotel_ml.csv&quot;) %&gt;% 
  mutate(
    is_canceled = as.factor(is_canceled)
  ) %&gt;% 
  mutate_if(is.character, as.factor) %&gt;% 
  select(-arrival_date_month) %&gt;% 
  drop_na() </code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   lead_time = col_double(),
##   total_of_special_requests = col_double(),
##   agent = col_double(),
##   previous_cancellations = col_double(),
##   adr = col_double(),
##   booking_changes = col_double(),
##   arrival_date_month = col_character(),
##   arrival_season = col_character(),
##   meal = col_character(),
##   market_segment = col_character(),
##   distribution_channel = col_character(),
##   reserved_room_type = col_character(),
##   deposit_type = col_character(),
##   customer_type = col_character(),
##   is_canceled = col_double()
## )</code></pre>
<pre class="r"><code>table_NA=
  hotel_ml %&gt;%
  summarise_all(funs(sum(is.na(.))))</code></pre>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre class="r"><code>t(table_NA) %&gt;%
  knitr::kable()</code></pre>
<pre><code>## Warning in kable_pipe(x = structure(c(&quot;lead_time&quot;,
## &quot;total_of_special_requests&quot;, : The table should have a header (column names)</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="left">lead_time</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">total_of_special_requests</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">agent</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">previous_cancellations</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">adr</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">booking_changes</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">arrival_season</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">meal</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">market_segment</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">distribution_channel</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_type</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">deposit_type</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">customer_type</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">is_canceled</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>We used stepwise selection and concluded that all of our existing variables have statistical significance.</p>
<pre class="r"><code>fullmod = glm(is_canceled ~. , data = hotel_ml, family = binomial())</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre class="r"><code>finalmod = stats::step(fullmod, direction = &quot;both&quot;)</code></pre>
<pre><code>## Start:  AIC=45393.28
## is_canceled ~ lead_time + total_of_special_requests + agent + 
##     previous_cancellations + adr + booking_changes + arrival_season + 
##     meal + market_segment + distribution_channel + reserved_room_type + 
##     deposit_type + customer_type</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>##                             Df Deviance   AIC
## &lt;none&gt;                            45323 45393
## - agent                      1    45329 45397
## - previous_cancellations     1    45340 45408
## - reserved_room_type         7    45371 45427
## - distribution_channel       3    45466 45530
## - meal                       4    45498 45560
## - customer_type              3    45544 45608
## - booking_changes            1    45541 45609
## - arrival_season             3    45659 45723
## - adr                        1    45721 45789
## - lead_time                  1    46488 46556
## - market_segment             6    46718 46776
## - total_of_special_requests  1    48908 48976
## - deposit_type               2    49779 49845</code></pre>
<pre><code>
train/test split:

```r
set.seed(1234)
train_df = sample_frac(hotel_ml, 0.8)
test_df = anti_join(hotel_ml, train_df)</code></pre>
<pre><code>## Joining, by = c(&quot;lead_time&quot;, &quot;total_of_special_requests&quot;, &quot;agent&quot;, &quot;previous_cancellations&quot;, &quot;adr&quot;, &quot;booking_changes&quot;, &quot;arrival_season&quot;, &quot;meal&quot;, &quot;market_segment&quot;, &quot;distribution_channel&quot;, &quot;reserved_room_type&quot;, &quot;deposit_type&quot;, &quot;customer_type&quot;, &quot;is_canceled&quot;)</code></pre>
<pre class="r"><code>logistic_fit =  
  train_df %&gt;% 
  glm(is_canceled ~. , data = ., family = binomial())</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<p>Model output:</p>
<pre class="r"><code>logistic_fit %&gt;% 
  broom::tidy() %&gt;% 
  mutate(OR = exp(estimate)) %&gt;%
  select(term, log_OR = estimate, OR, p.value) %&gt;% 
  arrange(desc(OR)) %&gt;% 
  knitr::kable(digits = 3, caption = &quot;Logistic Regression Output&quot;) </code></pre>
<table>
<caption>Logistic Regression Output</caption>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">log_OR</th>
<th align="right">OR</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">deposit_typeNon Refund</td>
<td align="right">5.156</td>
<td align="right">173.389</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">market_segmentOnline TA</td>
<td align="right">1.479</td>
<td align="right">4.388</td>
<td align="right">0.007</td>
</tr>
<tr class="odd">
<td align="left">market_segmentDirect</td>
<td align="right">0.981</td>
<td align="right">2.668</td>
<td align="right">0.088</td>
</tr>
<tr class="even">
<td align="left">mealFB</td>
<td align="right">0.745</td>
<td align="right">2.106</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">market_segmentComplementary</td>
<td align="right">0.713</td>
<td align="right">2.041</td>
<td align="right">0.357</td>
</tr>
<tr class="even">
<td align="left">customer_typeTransient</td>
<td align="right">0.662</td>
<td align="right">1.938</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">market_segmentGroups</td>
<td align="right">0.656</td>
<td align="right">1.928</td>
<td align="right">0.230</td>
</tr>
<tr class="even">
<td align="left">mealSC</td>
<td align="right">0.302</td>
<td align="right">1.352</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeB</td>
<td align="right">0.195</td>
<td align="right">1.215</td>
<td align="right">0.069</td>
</tr>
<tr class="even">
<td align="left">market_segmentOffline TA/TO</td>
<td align="right">0.151</td>
<td align="right">1.163</td>
<td align="right">0.781</td>
</tr>
<tr class="odd">
<td align="left">previous_cancellations</td>
<td align="right">0.136</td>
<td align="right">1.145</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">customer_typeTransient-Party</td>
<td align="right">0.117</td>
<td align="right">1.124</td>
<td align="right">0.353</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeD</td>
<td align="right">0.115</td>
<td align="right">1.121</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="left">adr</td>
<td align="right">0.007</td>
<td align="right">1.007</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">lead_time</td>
<td align="right">0.005</td>
<td align="right">1.005</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">agent</td>
<td align="right">0.000</td>
<td align="right">1.000</td>
<td align="right">0.030</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeE</td>
<td align="right">-0.024</td>
<td align="right">0.976</td>
<td align="right">0.702</td>
</tr>
<tr class="even">
<td align="left">mealUndefined</td>
<td align="right">-0.066</td>
<td align="right">0.936</td>
<td align="right">0.683</td>
</tr>
<tr class="odd">
<td align="left">arrival_seasonWinter</td>
<td align="right">-0.209</td>
<td align="right">0.811</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">reserved_room_typeC</td>
<td align="right">-0.217</td>
<td align="right">0.805</td>
<td align="right">0.264</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeF</td>
<td align="right">-0.234</td>
<td align="right">0.791</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">booking_changes</td>
<td align="right">-0.317</td>
<td align="right">0.728</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeG</td>
<td align="right">-0.433</td>
<td align="right">0.649</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">mealHB</td>
<td align="right">-0.433</td>
<td align="right">0.648</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">arrival_seasonSpring</td>
<td align="right">-0.462</td>
<td align="right">0.630</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">reserved_room_typeH</td>
<td align="right">-0.469</td>
<td align="right">0.626</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="left">arrival_seasonSummer</td>
<td align="right">-0.602</td>
<td align="right">0.548</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">total_of_special_requests</td>
<td align="right">-1.021</td>
<td align="right">0.360</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">customer_typeGroup</td>
<td align="right">-1.204</td>
<td align="right">0.300</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="left">(Intercept)</td>
<td align="right">-1.317</td>
<td align="right">0.268</td>
<td align="right">0.015</td>
</tr>
<tr class="odd">
<td align="left">distribution_channelTA/TO</td>
<td align="right">-1.540</td>
<td align="right">0.214</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">deposit_typeRefundable</td>
<td align="right">-1.568</td>
<td align="right">0.208</td>
<td align="right">0.040</td>
</tr>
<tr class="odd">
<td align="left">market_segmentCorporate</td>
<td align="right">-1.645</td>
<td align="right">0.193</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">distribution_channelDirect</td>
<td align="right">-2.204</td>
<td align="right">0.110</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">distribution_channelGDS</td>
<td align="right">-2.874</td>
<td align="right">0.056</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<p><strong>Comment</strong> As we can see from the output, deposit type: non refund has the largest odds ratio(173.389), indicating that the guests with non refundable test are significantly more likely to cancel the bookings compared to no deposit guests. This finding is rather counter-intuitive and also raises the question about the validity of the dataset.</p>
<p>We furthur generated the most important variables of our model:</p>
<pre class="r"><code>caret::varImp(logistic_fit) %&gt;%
 arrange(desc(Overall)) %&gt;%
 knitr::kable(digits = 3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Overall</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">total_of_special_requests</td>
<td align="right">48.779</td>
</tr>
<tr class="even">
<td align="left">deposit_typeNon Refund</td>
<td align="right">32.904</td>
</tr>
<tr class="odd">
<td align="left">lead_time</td>
<td align="right">30.214</td>
</tr>
<tr class="even">
<td align="left">adr</td>
<td align="right">17.725</td>
</tr>
<tr class="odd">
<td align="left">arrival_seasonSummer</td>
<td align="right">15.405</td>
</tr>
<tr class="even">
<td align="left">booking_changes</td>
<td align="right">12.763</td>
</tr>
<tr class="odd">
<td align="left">arrival_seasonSpring</td>
<td align="right">12.659</td>
</tr>
<tr class="even">
<td align="left">distribution_channelTA/TO</td>
<td align="right">10.285</td>
</tr>
<tr class="odd">
<td align="left">distribution_channelDirect</td>
<td align="right">9.370</td>
</tr>
<tr class="even">
<td align="left">mealHB</td>
<td align="right">8.872</td>
</tr>
<tr class="odd">
<td align="left">distribution_channelGDS</td>
<td align="right">8.542</td>
</tr>
<tr class="even">
<td align="left">mealSC</td>
<td align="right">7.061</td>
</tr>
<tr class="odd">
<td align="left">customer_typeTransient</td>
<td align="right">5.375</td>
</tr>
<tr class="even">
<td align="left">arrival_seasonWinter</td>
<td align="right">4.835</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeG</td>
<td align="right">4.423</td>
</tr>
<tr class="even">
<td align="left">mealFB</td>
<td align="right">3.850</td>
</tr>
<tr class="odd">
<td align="left">previous_cancellations</td>
<td align="right">3.607</td>
</tr>
<tr class="even">
<td align="left">reserved_room_typeD</td>
<td align="right">3.229</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeH</td>
<td align="right">2.977</td>
</tr>
<tr class="even">
<td align="left">reserved_room_typeF</td>
<td align="right">2.870</td>
</tr>
<tr class="odd">
<td align="left">market_segmentCorporate</td>
<td align="right">2.866</td>
</tr>
<tr class="even">
<td align="left">market_segmentOnline TA</td>
<td align="right">2.721</td>
</tr>
<tr class="odd">
<td align="left">customer_typeGroup</td>
<td align="right">2.685</td>
</tr>
<tr class="even">
<td align="left">agent</td>
<td align="right">2.164</td>
</tr>
<tr class="odd">
<td align="left">deposit_typeRefundable</td>
<td align="right">2.050</td>
</tr>
<tr class="even">
<td align="left">reserved_room_typeB</td>
<td align="right">1.817</td>
</tr>
<tr class="odd">
<td align="left">market_segmentDirect</td>
<td align="right">1.707</td>
</tr>
<tr class="even">
<td align="left">market_segmentGroups</td>
<td align="right">1.199</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeC</td>
<td align="right">1.118</td>
</tr>
<tr class="even">
<td align="left">customer_typeTransient-Party</td>
<td align="right">0.928</td>
</tr>
<tr class="odd">
<td align="left">market_segmentComplementary</td>
<td align="right">0.921</td>
</tr>
<tr class="even">
<td align="left">mealUndefined</td>
<td align="right">0.409</td>
</tr>
<tr class="odd">
<td align="left">reserved_room_typeE</td>
<td align="right">0.382</td>
</tr>
<tr class="even">
<td align="left">market_segmentOffline TA/TO</td>
<td align="right">0.279</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Make predictions
probabilities &lt;- logistic_fit%&gt;% predict(test_df, type = &quot;response&quot;)
predicted.classes &lt;- ifelse(probabilities &gt; 0.5, &quot;1&quot;, &quot;0&quot;)
# Prediction accuracy
observed.classes &lt;- test_df$is_canceled
mean(predicted.classes == observed.classes, na.rm = T)</code></pre>
<pre><code>## [1] 0.7566094</code></pre>
<p>use cross validation</p>
<pre class="r"><code># cv_df = crossv_mc(hotel_ml, 10)
# cv = 
# cv_df %&gt;% 
#   mutate(
#     train = map(train, as_tibble),
#     test = map(test, as_tibble),
#     fit_logistic = map(train, ~glm(is_canceled ~. , data = .x, family = binomial()))
#   )
#   </code></pre>
<p>fit logistic regression:</p>
<pre class="r"><code># fit_logistic = 
#   train_df %&gt;% 
#   glm(is_canceled ~. , data = ., family = binomial())</code></pre>
<p>regression output:</p>
<pre class="r"><code># fit_logistic %&gt;% 
#   broom::tidy() %&gt;% 
#   mutate(OR = exp(estimate)) %&gt;%
#   select(term, log_OR = estimate, OR, p.value) %&gt;% 
#   knitr::kable(digits = 3)</code></pre>
<p>model evaluation &amp; diagnoistics possible outliers:</p>
<p>Validation of Predicted Values</p>
<pre class="r"><code># test_predicted &lt;- predict(fit_logistic, newdata = test_df, type = &quot;response&quot;)</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
