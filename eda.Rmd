---
title: "Exploratory Analysis"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
  
---

<img src="./images/eda_1.jpg">\
_image source: google_


### Overview
The data [**Hotel Booking Demand Dataset**](https://www.sciencedirect.com/science/article/pii/S2352340918315191) were collected from two hotels (Resort hotel and City hotel) located in Portugal. It contains hotel booking information between the 1st of July of 2015 and the 31st of August 2017. For a speedy performance of our predictive model, we only select data from 2016 for training.

```{r setup, echo=FALSE, message=F}
library(dplyr)
library(tidyverse)
library(plotly)
library(ggplot2)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r data,echo=FALSE, message=F}
hotel_whole_df <- read.csv("./data/hotel_bookings.csv",na = c("", "NA", "NULL")) 
hotel_df <- hotel_whole_df %>% filter(arrival_date_year==2016)
```

The dimension of the original published dataset is `r nrow(hotel_whole_df)` rows by `r ncol(hotel_whole_df)` columns. After filtering instances from year 2016, the resulting dataset has `r nrow(hotel_df)` rows.   

We aim to explore the following questions using our exploratory data analysis:  

* Where do the guests come from?  
(add content)


### Exploratory Data Analysis

#### Home Country of Guests
```{r choropleth maps, echo=F, message=F, warning=F}
hotel_df %>% 
  select(country, is_canceled) %>% 
  filter(is_canceled == 0) %>% 
  group_by(country) %>% 
  summarise(
    total_booking = n(),
  ) %>% 
  mutate(
    booking_percent = round(total_booking/sum(total_booking)*100, 2),
    text_label = str_c("Country: ", country, "\nBooking percent: ", booking_percent, "%")
  ) %>% 
  plot_ly(locations = ~country, z = ~booking_percent, type ="choropleth",
          colorscale="Viridis", zmin = 0, zmax = 30,
          text = ~text_label)
  labs(title = "Home Country of Guests")
```                


#### Seasonal Fluctuation
```{r month_lineplot, echo=F, message=F, warning=F}
month_line<-hotel_df %>%
  select(hotel,arrival_date_month) %>%
  group_by(hotel, arrival_date_month) %>%
  summarize(
    count = n()
  ) %>%
  ggplot(aes(x=factor(arrival_date_month,level=month.name),y=count,group = hotel,color = hotel))+
  geom_point()+
  geom_line() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+
  labs(title = "Hotel Booking per Month", x = "Month", y = "Number of Bookings")
  
ggplotly(month_line)
```
City hotel has the most booking in Spring (May-June) and Autumn (October); the number of bookings for the resort hotel has less fluctuation compared to that of the city hotel. The booking demand goes down slightly from June to September for the resort hotel. 

```{r adr_month, message=F,echo=F}
adr_month<-hotel_df %>% 
  select(hotel,arrival_date_month,adr) %>%
  group_by(hotel, arrival_date_month) %>%
  summarize(
    adr=mean(adr)
  ) %>% 
  ggplot(aes(x=factor(arrival_date_month,level=month.name), y = adr, group = hotel, color = hotel))+
  geom_point()+
  geom_line()+
  labs(title = "Monthly Fluctuation on Average Daily Rate (ADR)", x = "Month", y = "Average Daily Rate")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

ggplotly(adr_month)


```
The average daily rate (ADR) for the city hotel increases slightly between May and September, which make sense considering the booking demand pattern for city hotel.The ADR for the resort hotel has more variation throughout the year, and its ADR reaches its peak during Summer.

#### Room Type Investigation
```{r roomType, echo=F,message=F,warning=F}
rmType_adr_box<-hotel_df %>%
  select(hotel,assigned_room_type,adr) %>%
  ggplot(aes(x = assigned_room_type, y = adr, fill = hotel))+
  geom_boxplot(position = position_dodge(1,preserve = "single"))+
  ylim(-10,350)+
  labs(x="Assigned Room Type",y = "ADR",title = "Assigned Room Type vs. ADR - Box")



rmType_adr_line<-hotel_df %>%
  select(hotel,assigned_room_type,adr) %>%
  group_by(hotel,assigned_room_type) %>%
  summarize(adr=mean(adr)) %>%
  ggplot(aes(x = assigned_room_type, y = adr,color = hotel,group=hotel))+
  geom_line()+
  ylim(-10,250)+
  labs(x = "Assigned Room Type", y = "ADR", title = "Assigned Room Type vs. ADR - Line")

library(patchwork)
rmType_adr_box/rmType_adr_line
```



